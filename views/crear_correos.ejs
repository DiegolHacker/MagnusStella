<%- include('includes/navigation.ejs') %>

<div class="signup-box box">
    <div class="signup-title title">
        <h5>Ingresa la informacion de la nueva pregunta</h5>
    </div>

    <% if (typeof error !== 'undefined') { %>
        <div class="alert">
            <p class="error">
                <%= error %>
            </p>
        </div>
    <% } %>

    <form action="/emails/correos/crear/<%= marca %>" method="POST" enctype="multipart/form-data">
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
        <div class="credential-input">
            <label for="question">Pregunta:</label>
            <input type="text" name="question" id="question" placeholder="Ingresa la pregunta"><br>
            <label for="tipo">Tipo de pregunta:</label>
            <select name="tipo" id="tipo">
                <option value="1">Cerrada (una respuesta)</option>
                <option value="2">Abierta</option>
                <option value="3">Checkbox (multiples respuestas)</option>
            </select>
            <div id="opciones-container">
            </div>
            <button id="button_opcion" type="button">Añadir Opción</button>
            <div class="ingresarBtn">
                <button type="submit" class="ingresar-btn">Guardar pregunta</button>
            </div>
        </div>
    </form>
</div>

<%- include('includes/footer.ejs') %>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        var tipoSelect = document.getElementById("tipo");
        var opcionesContainer = document.getElementById("opciones-container");
        var addOptionButton = document.getElementById("button_opcion");

        addOptionButton.addEventListener("click", function () {
            var tipo = parseInt(tipoSelect.value);
            var existingOptions = opcionesContainer.querySelectorAll(".opcion");

            if (tipo === 1 || tipo === 3) {
                if (existingOptions.length < 8) {
                    var newOptionInput = document.createElement("div");
                    newOptionInput.setAttribute("class", "opcion");
                    var input = document.createElement("input");
                    input.setAttribute("type", "text");
                    input.setAttribute("name", "op_" + (existingOptions.length + 1));
                    input.setAttribute("class", "input");
                    input.setAttribute("placeholder", "Opción " + (existingOptions.length + 1));
                    newOptionInput.appendChild(input);
                    var deleteButton = document.createElement("button");
                    deleteButton.innerHTML = "<i class='bx bx-trash icon'></i>";
                    deleteButton.addEventListener("click", function () {
                        opcionesContainer.removeChild(newOptionInput);
                    });
                    newOptionInput.appendChild(deleteButton);
                    opcionesContainer.appendChild(newOptionInput);
                } else {
                    alert("¡Has alcanzado el límite máximo de opciones!");
                }
            } else if (tipo === 2) {
                if (existingOptions.length < 1) {
                    var newOptionInput = document.createElement("div");
                    newOptionInput.setAttribute("class", "opcion");
                    var input = document.createElement("input");
                    input.setAttribute("type", "text");
                    input.setAttribute("name", "op_" + (existingOptions.length + 1));
                    input.setAttribute("class", "input");
                    input.setAttribute("placeholder", "Placeholder " + (existingOptions.length + 1));
                    newOptionInput.appendChild(input);
                    var deleteButton = document.createElement("button");
                    deleteButton.innerHTML = "<i class='bx bx-trash icon'></i>";
                    deleteButton.addEventListener("click", function () {
                        opcionesContainer.removeChild(newOptionInput);
                    });
                    newOptionInput.appendChild(deleteButton);
                    opcionesContainer.appendChild(newOptionInput);
                } else {
                    alert("¡Has alcanzado el límite máximo de opciones!");
                }
            }
        });

        tipoSelect.addEventListener("change", function () {
            var tipo = parseInt(this.value);

            // Limpiar el contenedor de opciones
            opcionesContainer.innerHTML = "";

        
        });
    });
</script>