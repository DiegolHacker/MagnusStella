<%-include('includes/navigation.ejs', {
    titulo: titulo,
    promedioPuntajes: promedioPuntajes,
    tasaDeRespuesta: tasaDeRespuesta,
    encuestasEnviadas: encuestasEnviadas,
    marca:marca,
    ruta: ruta
}) %>


<div class="graficas">
    
    <div class="cat-search">    
        <input id="buscar" class="input is-info" type="text" placeholder="Buscar..." />
        <%-include('includes/categorias.ejs', { marca:marca }) %>

    </div>



    <div class="top-graficas">
        <div id="promedio-mes-div" class="graphContainer">
            <canvas id="promedioxMes"></canvas>
        </div>

        <div id="tasaContestacion" class="graphContainer">
            <canvas id="tasaContestada"></canvas>
        </div>



    </div>

    <div class="bottom-graficas">

        <div id="respuesta-enviada-div" class="graphContainer">
            <canvas id="respuestaEnviada"></canvas>
        </div>

        <div id="promedioEstrellaNumero" class="graphContainer">
            <h3>Calificacion promedio</h3>
            <div id="estrella-numero">
                <div id="divison">
                    <img src="/images/Estrella vacia 11.png" class="avatar" alt="Avatar" id="estrella1">
                    <img src="/images/Estrella reyena 11.png" class="avatar" alt="Avatar" id="estrella2" style="--cut-value: <%=porcentaje%>%;">
                </div>
                <h1><%= numAVGEstrella %></h1>
            </div>

        </div>

    </div>


</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    let promedioMes = JSON.parse('<%- JSON.stringify(promedioPuntajes) %>');
    let tasaDeRespuesta = JSON.parse('<%- JSON.stringify(tasaDeRespuesta) %>');
    let respuestasEnviadas = JSON.parse('<%- JSON.stringify(encuestasEnviadas) %>');


    function handleOptionChange(selectElement) {
            // Get the selected value
            var selectedValue = selectElement.value;

            console.log("Selected option:", selectedValue);
            return selectedValue;
    }

    //AJAX para busqueda de producto

    const accion_asincrona = () => {
        console.log('Buscando...');
        const valor_busqueda = document.getElementById('buscar').value;
        //función que manda la petición asíncrona
        fetch('/graphics/dashboard/<%=marca%>/' + valor_busqueda, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            }
        }).then((result) => {
            console.log(result);
            return result.json(); //Regresa otra promesa
        }).then((data) => {
            console.log(data);
            //Modificamos el DOM de nuestra página de acuerdo a los datos de la segunda promesa
            //...
        }).catch(err => {
            console.log(err);
        });
    };
    document.getElementById('buscar').onkeyup = accion_asincrona;

</script>
<%-include('includes/footer.ejs')%>